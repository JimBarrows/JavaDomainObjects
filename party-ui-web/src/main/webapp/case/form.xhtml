<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	ns:a="http://richfaces.org/a4j">
	<body>
		<f:view>
			<ui:composition template="/layout/template.xhtml">
				<ui:define name="body">
					<h:form id="caseForm">
						<rich:panel id="caseFormPanel" header="Case">
						
							<s:decorate id="descriptionTextDecoration"
								template="/layout/edit.xhtml">
								<ui:define name="label">Description:</ui:define>
								<h:inputText id="descriptionText" value="#{case.description}"
									required="true" />
							</s:decorate>
							
							<s:decorate id="startDateDecoration"
								template="/layout/edit.xhtml">
								<ui:define name="label">Start:</ui:define>
								<rich:calendar id="startDate" popup="true" value="#{case.start}"
									required="true" enableManualInput="true" />
							</s:decorate>
							
							<s:decorate id="statusSelectOneDecoration"
								template="/layout/edit.xhtml">
								<ui:define name="label">Status</ui:define>
								<h:selectOneMenu id="statusSelectOne"
									value="#{case.inTheStateOf}" required="true">
									<s:selectItems
										value="#{caseStatusTypeListForUserLogin.resultList}"
										var="curStatus" label="#{curStatus.description}"
										noSelectionLabel="Please select one." />
									<s:convertEntity />
								</h:selectOneMenu>
								<s:link view="/party/case/status/type/form.xhtml"
									propagation="nest" value="Add Status">
									<f:param name="caseStatusTypeId" value="" />
									<f:param name="originalView" value="/party/case/form.xhtml" />
								</s:link>
							</s:decorate>

							<div style="clear: both" />

							<s:fragment rendered="#{caseHome.managed}">

								<div class="actionButtons">
									<h:commandButton id="addPartyButton"
										action="#{caseHome.addCaseRole}" value="Add Contact">
										<a:support reRender="caseRoleListTable" event="onclick" />
										<s:conversationPropagation type="join" />
									</h:commandButton>
									
									<s:button id="addCaseRoleTypeButton"
										view="/party/case/role/type/form.xhtml" value="Create Role"
										propagation="nest">
										<f:param name="caseRoleTypeId" value="" />
										<f:param name="originalView"
											value="/party/case/form.xhtml" />
										<a:support reRender="caseRoleListTable" event="onclick" />
									</s:button>
								</div>
								<rich:dataTable id="caseRoleListTable" value="#{case.involving}"
									var="curCaseRole">
									<f:facet name="header">Parties Involved</f:facet>

									<rich:column sortable="true" title="Role In Case">
										<f:facet name="header">Role</f:facet>
										<h:selectOneMenu id="roleSelectOne"
											value="#{curCaseRole.describedBy}">
											<s:selectItems
												value="#{caseRoleTypeListForUserLogin.resultList}"
												var="curCaseRoleType" label="#{curCaseRoleType.description}"
												noSelectionLabel="Please select one." />
											<s:convertEntity />
										</h:selectOneMenu>
									</rich:column>

									<rich:column sortable="true" title="Party">
										<f:facet name="header">Party</f:facet>
										<h:selectOneMenu id="partySelectOne" value="#{curCaseRole.of}">
											<s:selectItems value="#{partyListForUserLogin.resultList}"
												var="party" noSelectionLabel="Please select one."
												label="#{ labelHelper.getPartyLabel(party)}" />
											<s:convertEntity />
										</h:selectOneMenu>

									</rich:column>

									<rich:column>
										<div class="actionButtons">
											<h:commandButton id="deleteCaseRoleButton"
												action="#{caseHome.deleteCaseRole(curCaseRole)}"
												value="Delete">
												<a:support reRender="caseRoleListTable" event="onclick" />
												<s:conversationPropagation type="join" />
											</h:commandButton>
										</div>
									</rich:column>
								</rich:dataTable>

								<ui:include
									src="/party/communicationEvent/communicationEventTable.xhtml">
									<ui:param name="edit" value="#{false}" />
									<ui:param name="view" value="#{true}" />
									<ui:param name="communicationEventList"
										value="#{case.encompassing}" />
								</ui:include>
							</s:fragment>
						</rich:panel>
						<ui:include src="/components/homeButtons.xhtml">
							<ui:param name="home" value="#{caseFormController}" />
							
						</ui:include>
					</h:form>

				</ui:define>
			</ui:composition>
		</f:view>
	</body>
</html>
